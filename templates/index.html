<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoGen Web Tester - Live Testing UI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- CodeMirror 5 (more compatible than v6 ES modules) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/comment/comment.min.js"></script>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- Main VS Code-style layout -->
    <div class="vscode-layout">
        <div class="code-editor-container">
                <!-- Live Browser Sidebar (Left) -->
                <div id="browser-sidebar" class="browser-sidebar">
                    <div class="browser-sidebar-header">
                        <div class="browser-title">
                            <span class="browser-icon">üåê</span>
                            <span class="browser-label">LIVE BROWSER</span>
                            <span id="browser-test-name" class="browser-test-name"></span>
                        </div>
                        <div class="browser-controls">
                            <span id="browser-status" class="status-badge status-idle">IDLE</span>
                            <button id="close-browser-sidebar" class="btn-icon">‚úï</button>
                        </div>
                    </div>
                    <div class="browser-sidebar-body">
                        <div class="browser-screenshot-container">
                            <!-- Loading State -->
                            <div id="browser-loading" class="browser-loading active">
                                <div class="loading-content">
                                    <div class="loading-spinner">
                                        <div class="spinner-ring"></div>
                                        <div class="spinner-ring"></div>
                                        <div class="spinner-ring"></div>
                                    </div>
                                    <div class="loading-text">Starting browser...</div>
                                    <div class="loading-subtext">Initializing Playwright session</div>
                                </div>
                            </div>

                            <!-- Browser Screenshot -->
                            <img id="browser-screenshot" src="" alt="Browser preview" style="display: none;">
                            <div id="screenshot-timestamp" class="screenshot-timestamp"></div>
                        </div>
                    </div>
                </div>

                <!-- File Explorer Sidebar (Left) -->
                <div id="file-explorer" class="file-explorer">
                    <!-- Saved Tests Section -->
                    <div class="file-explorer-section">
                        <div class="file-explorer-header">
                            <span class="file-explorer-title">SAVED TESTS</span>
                            <button id="new-test-btn" class="btn-icon-small" title="New Test">+</button>
                        </div>
                        <div id="file-list" class="file-list">
                            <!-- Files will be loaded here -->
                        </div>
                    </div>

                    <!-- AI Steps Section -->
                    <div class="file-explorer-section">
                        <div class="file-explorer-header">
                            <span class="file-explorer-title">AI STEPS</span>
                            <button id="new-ai-step-btn" class="btn-icon-small" title="New AI Step">+</button>
                        </div>
                        <div id="ai-steps-list" class="file-list">
                            <!-- AI step items loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Resizer -->
                <div id="explorer-resizer" class="explorer-resizer"></div>

                <!-- Code Editor Section (Center) -->
                <div class="code-editor-section">
                    <!-- Tabs -->
                    <div id="editor-tabs" class="editor-tabs">
                        <div class="editor-tabs-container"></div>
                        <div class="editor-tabs-actions">
                            <button id="toggle-browser" class="btn btn-small">üåê Browser</button>
                            <button id="toggle-chat" class="btn btn-small">üí¨ Chat</button>
                            <button id="close-all-tabs" class="btn-icon-small" title="Close All">‚äó</button>
                        </div>
                    </div>

                    <!-- Editor Content -->
                    <div class="editor-content">
                        <div id="codemirror-editor"></div>
                    </div>
                </div>

                <!-- AI Chat Sidebar (Right) -->
                <div id="ai-chat-sidebar" class="ai-chat-sidebar">
                    <div class="chat-sidebar-header">
                        <h3>üí¨ AI Assistant</h3>
                        <button id="close-chat-sidebar" class="btn-icon">‚úï</button>
                    </div>
                    <div class="chat-sidebar-body">
                        <div id="chat-messages" class="chat-messages"></div>
                        <div class="chat-input-container">
                            <div id="image-preview-container" class="image-preview-container" style="display: none;">
                                <div class="image-preview-header">
                                    <span class="image-preview-label">üìé Image attached</span>
                                    <button id="remove-image" class="btn-icon-small">‚úï</button>
                                </div>
                                <img id="image-preview" class="image-preview" alt="Preview">
                            </div>
                            <div id="drop-zone" class="drop-zone">
                                <textarea id="chat-input" placeholder="Ask AI to generate or modify code... (drag & drop images here)" rows="3"></textarea>
                                <div class="drop-zone-overlay">
                                    <div class="drop-zone-content">
                                        <span class="drop-zone-icon">üìÅ</span>
                                        <span class="drop-zone-text">Drop image here</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-buttons">
                                <label for="file-input" class="btn btn-small" style="cursor: pointer; margin: 0;">
                                    üìé Attach
                                    <input type="file" id="file-input" accept="image/*" style="display: none;">
                                </label>
                                <button id="send-chat" class="btn btn-primary btn-small">Send</button>
                                <button id="clear-chat-btn" class="btn btn-small">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Output Panel (Agent Log) - VS Code Style -->
            <div id="output-panel" class="output-panel">
                <div class="output-panel-header">
                    <div class="output-panel-title">
                        <button id="toggle-output" class="output-toggle-btn">
                            <span class="output-toggle-icon">‚ñº</span>
                            <span class="output-title-text">OUTPUT</span>
                        </button>
                    </div>
                    <div class="output-panel-actions">
                        <div class="log-tabs">
                            <button class="log-tab active" data-tab="human">üë§ Human-Readable</button>
                            <button class="log-tab" data-tab="technical">üîß Technical</button>
                        </div>
                        <button id="clear-log" class="btn-icon-small" title="Clear Output">üóë</button>
                    </div>
                </div>
                <div class="output-panel-body">
                    <div id="human-log-container" class="log-container active"></div>
                    <div id="technical-log-container" class="log-container"></div>
                </div>
            </div>

            <!-- Code Preview Panel -->
            <div id="code-preview-panel" class="code-preview-panel">
                <div class="code-preview-header">
                    <div class="code-preview-title">
                        <span class="code-preview-icon">‚ú®</span>
                        <span class="code-preview-label">CODE SUGGESTION</span>
                    </div>
                    <div class="code-preview-actions">
                        <button id="accept-code-btn" class="btn-preview btn-accept">‚úì Accept</button>
                        <button id="reject-code-btn" class="btn-preview btn-reject">‚úó Reject</button>
                        <button id="close-preview-btn" class="btn-icon-small">‚úï</button>
                    </div>
                </div>
                <div class="code-preview-body">
                    <div id="code-preview-explanation" class="code-preview-explanation"></div>
                    <div class="code-preview-diff-container">
                        <div class="diff-column">
                            <div class="diff-column-header">CURRENT CODE</div>
                            <pre id="code-preview-current" class="diff-code-block"></pre>
                        </div>
                        <div class="diff-column">
                            <div class="diff-column-header">SUGGESTED CODE (AI)</div>
                            <pre id="code-preview-suggested" class="diff-code-block"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Step Modal -->
    <div id="ai-step-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ü§ñ AI Test Steps</h2>
                    <span class="close-ai-step-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="ai-step-name">Test Name</label>
                        <input type="text" id="ai-step-name" class="form-input" placeholder="Login Test">
                    </div>
                    <div class="form-group">
                        <label for="ai-step-steps">Test Steps (Natural Language)</label>
                        <textarea id="ai-step-steps" class="form-input" rows="10" placeholder="1. Go to https://example.com
2. Click login button
3. Fill email field
4. Click submit"></textarea>
                    </div>
                    <div class="button-group">
                        <button id="save-ai-step-btn" class="btn btn-primary">Save</button>
                        <button id="cancel-ai-step-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
