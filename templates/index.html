<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoGen Web Tester - Live Testing UI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- CodeMirror 5 (more compatible than v6 ES modules) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/comment/comment.min.js"></script>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- Main VS Code-style layout -->
    <div class="vscode-layout">
        <div class="code-editor-container">
                <!-- Live Browser Sidebar (Left) -->
                <div id="browser-sidebar" class="browser-sidebar">
                    <div class="browser-sidebar-header">
                        <div class="browser-title">
                            <span class="browser-icon">üåê</span>
                            <span class="browser-label">LIVE BROWSER</span>
                            <span id="browser-test-name" class="browser-test-name"></span>
                        </div>
                        <div class="browser-controls">
                            <span id="browser-status" class="status-badge status-idle">IDLE</span>
                            <button id="close-browser-sidebar" class="btn-icon">‚úï</button>
                        </div>
                    </div>
                    <div class="browser-sidebar-body">
                        <div class="browser-screenshot-container">
                            <!-- Loading State -->
                            <div id="browser-loading" class="browser-loading active">
                                <div class="loading-content">
                                    <div class="loading-spinner">
                                        <div class="spinner-ring"></div>
                                        <div class="spinner-ring"></div>
                                        <div class="spinner-ring"></div>
                                    </div>
                                    <div class="loading-text">Starting browser...</div>
                                    <div class="loading-subtext">Initializing Playwright session</div>
                                </div>
                            </div>

                            <!-- Browser Screenshot -->
                            <img id="browser-screenshot" src="" alt="Browser preview" style="display: none;">
                            <div id="screenshot-timestamp" class="screenshot-timestamp"></div>
                        </div>
                    </div>
                </div>

                <!-- File Explorer Sidebar (Left) -->
                <div id="file-explorer" class="file-explorer">
                    <!-- Dashboard Section -->
                    <div class="file-explorer-section dashboard-section">
                        <button id="dashboard-btn" class="dashboard-menu-item">
                            <span class="dashboard-icon">üìä</span>
                            <span class="dashboard-label">DASHBOARD</span>
                        </button>
                    </div>

                    <!-- Saved Tests Section -->
                    <div class="file-explorer-section">
                        <div class="file-explorer-header">
                            <span class="file-explorer-title">SAVED TESTS</span>
                            <div class="file-explorer-header-actions">
                                <button id="run-all-tests-btn" class="btn-icon-small" title="Run All Tests">‚ñ∂‚ñ∂</button>
                                <button id="new-test-btn" class="btn-icon-small" title="New Test">+</button>
                            </div>
                        </div>
                        <div id="file-list" class="file-list">
                            <!-- Files will be loaded here -->
                        </div>
                    </div>

                    <!-- AI Steps Section -->
                    <div class="file-explorer-section">
                        <div class="file-explorer-header">
                            <span class="file-explorer-title">AI STEPS</span>
                            <button id="new-ai-step-btn" class="btn-icon-small" title="New AI Step">+</button>
                        </div>
                        <div id="ai-steps-list" class="file-list">
                            <!-- AI step items loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Resizer -->
                <div id="explorer-resizer" class="explorer-resizer"></div>

                <!-- Code Editor Section (Center) -->
                <div class="code-editor-section">
                    <!-- Tabs -->
                    <div id="editor-tabs" class="editor-tabs">
                        <div class="editor-tabs-container"></div>
                        <div class="editor-tabs-actions">
                            <button id="toggle-browser" class="btn btn-small">üåê Browser</button>
                            <button id="toggle-chat" class="btn btn-small">üí¨ Chat</button>
                            <button id="close-all-tabs" class="btn-icon-small" title="Close All">‚äó</button>
                        </div>
                    </div>

                    <!-- Editor Content -->
                    <div class="editor-content">
                        <div id="codemirror-editor"></div>
                    </div>

                    <!-- Dashboard View -->
                    <div id="dashboard-view" class="dashboard-view" style="display: none;">
                        <div class="dashboard-header">
                            <div class="dashboard-title">
                                <span class="dashboard-icon-large">ü§ñ</span>
                                <h1>AutoGen Web Tester</h1>
                                <p class="dashboard-subtitle">AI-powered browser automation and testing</p>
                            </div>
                        </div>

                        <div class="dashboard-stats">
                            <div class="stat-card stat-primary">
                                <div class="stat-icon">üìù</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="dashboard-saved-tests">0</div>
                                    <div class="stat-label">SAVED TESTS</div>
                                </div>
                            </div>
                            <div class="stat-card stat-success">
                                <div class="stat-icon">‚úì</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="dashboard-passed">0</div>
                                    <div class="stat-label">PASSED</div>
                                </div>
                            </div>
                            <div class="stat-card stat-error">
                                <div class="stat-icon">‚úó</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="dashboard-failed">0</div>
                                    <div class="stat-label">FAILED</div>
                                </div>
                            </div>
                            <div class="stat-card stat-info">
                                <div class="stat-icon">ü§ñ</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="dashboard-ai-steps">0</div>
                                    <div class="stat-label">AI STEPS</div>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-get-started">
                            <h2>Get Started</h2>
                            <div class="get-started-cards">
                                <div class="get-started-card" id="new-test-card">
                                    <div class="get-started-icon">+</div>
                                    <h3>New Test</h3>
                                    <p>Create a new Playwright test</p>
                                </div>
                                <div class="get-started-card" id="new-ai-step-card">
                                    <div class="get-started-icon">ü§ñ</div>
                                    <h3>New AI Step</h3>
                                    <p>Write tests in natural language</p>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-empty-state" id="dashboard-empty-state">
                            <p class="empty-state-text">No file open</p>
                            <p class="empty-state-subtext">Open a file from the explorer or use AI Chat to generate code</p>
                        </div>
                    </div>
                </div>

                <!-- AI Chat Sidebar (Right) -->
                <div id="ai-chat-sidebar" class="ai-chat-sidebar">
                    <div class="chat-sidebar-header">
                        <h3>üí¨ AI Assistant</h3>
                        <button id="close-chat-sidebar" class="btn-icon">‚úï</button>
                    </div>
                    <div class="chat-sidebar-body">
                        <div id="chat-messages" class="chat-messages"></div>
                        <div class="chat-input-container">
                            <div id="image-preview-container" class="image-preview-container" style="display: none;">
                                <div class="image-preview-header">
                                    <span class="image-preview-label">üìé Image attached</span>
                                    <button id="remove-image" class="btn-icon-small">‚úï</button>
                                </div>
                                <img id="image-preview" class="image-preview" alt="Preview">
                            </div>
                            <div id="drop-zone" class="drop-zone">
                                <textarea id="chat-input" placeholder="Ask AI to generate or modify code... (drag & drop images here)" rows="3"></textarea>
                                <div class="drop-zone-overlay">
                                    <div class="drop-zone-content">
                                        <span class="drop-zone-icon">üìÅ</span>
                                        <span class="drop-zone-text">Drop image here</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-buttons">
                                <label for="file-input" class="btn btn-small" style="cursor: pointer; margin: 0;">
                                    üìé Attach
                                    <input type="file" id="file-input" accept="image/*" style="display: none;">
                                </label>
                                <button id="send-chat" class="btn btn-primary btn-small">Send</button>
                                <button id="clear-chat-btn" class="btn btn-small">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Output Panel (Agent Log) - VS Code Style -->
            <div id="output-panel" class="output-panel">
                <div class="output-panel-header">
                    <div class="output-panel-title">
                        <button id="toggle-output" class="output-toggle-btn">
                            <span class="output-toggle-icon">‚ñº</span>
                            <span class="output-title-text">OUTPUT</span>
                        </button>
                    </div>
                    <div class="output-panel-actions">
                        <div class="log-tabs">
                            <button class="log-tab active" data-tab="human">üë§ Human-Readable</button>
                            <button class="log-tab" data-tab="technical">üîß Technical</button>
                        </div>
                        <button id="clear-log" class="btn-icon-small" title="Clear Output">üóë</button>
                    </div>
                </div>
                <div class="output-panel-body">
                    <div id="human-log-container" class="log-container active"></div>
                    <div id="technical-log-container" class="log-container"></div>
                </div>
            </div>

            <!-- Code Preview Panel -->
            <div id="code-preview-panel" class="code-preview-panel">
                <div class="code-preview-header">
                    <div class="code-preview-title">
                        <span class="code-preview-icon">‚ú®</span>
                        <span class="code-preview-label">CODE SUGGESTION</span>
                    </div>
                    <div class="code-preview-actions">
                        <button id="accept-code-btn" class="btn-preview btn-accept">‚úì Accept</button>
                        <button id="reject-code-btn" class="btn-preview btn-reject">‚úó Reject</button>
                        <button id="close-preview-btn" class="btn-icon-small">‚úï</button>
                    </div>
                </div>
                <div class="code-preview-body">
                    <div id="code-preview-explanation" class="code-preview-explanation"></div>
                    <div class="code-preview-diff-container">
                        <div class="diff-column">
                            <div class="diff-column-header">CURRENT CODE</div>
                            <pre id="code-preview-current" class="diff-code-block"></pre>
                        </div>
                        <div class="diff-column">
                            <div class="diff-column-header">SUGGESTED CODE (AI)</div>
                            <pre id="code-preview-suggested" class="diff-code-block"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Step Modal -->
    <div id="ai-step-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ü§ñ AI Test Steps</h2>
                    <span class="close-ai-step-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="ai-step-name">Test Name</label>
                        <input type="text" id="ai-step-name" class="form-input" placeholder="Login Test">
                    </div>
                    <div class="form-group">
                        <label for="ai-step-steps">Test Steps (Natural Language)</label>
                        <textarea id="ai-step-steps" class="form-input" rows="10" placeholder="1. Go to https://example.com
2. Click login button
3. Fill email field
4. Click submit"></textarea>
                    </div>
                    <div class="button-group">
                        <button id="save-ai-step-btn" class="btn btn-primary">Save</button>
                        <button id="cancel-ai-step-btn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Results Summary Modal -->
        <div id="test-results-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìä Test Results Summary</h2>
                    <span class="close-test-results-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="results-summary">
                        <div class="results-stats">
                            <div class="stat-card stat-total">
                                <div class="stat-value" id="total-tests-run">0</div>
                                <div class="stat-label">Total Tests</div>
                            </div>
                            <div class="stat-card stat-passed">
                                <div class="stat-value" id="passed-tests-count">0</div>
                                <div class="stat-label">Passed</div>
                            </div>
                            <div class="stat-card stat-failed">
                                <div class="stat-value" id="failed-tests-count">0</div>
                                <div class="stat-label">Failed</div>
                            </div>
                            <div class="stat-card stat-time">
                                <div class="stat-value" id="total-execution-time">0s</div>
                                <div class="stat-label">Total Time</div>
                            </div>
                        </div>
                        <div class="results-list">
                            <h3>Individual Test Results</h3>
                            <div id="individual-results-container"></div>
                        </div>
                        <div class="results-artifacts">
                            <h3>Test Recording</h3>
                            <div id="test-video-container" style="display: none;">
                                <video id="test-video-player" controls style="width: 100%; max-height: 400px; border-radius: 8px;">
                                    <source id="test-video-source" type="video/webm">
                                    Your browser does not support video playback.
                                </video>
                                <div class="video-actions">
                                    <button id="download-video-btn" class="btn btn-secondary">
                                        üì• Download Video
                                    </button>
                                </div>
                            </div>
                            <div id="no-video-message" style="color: #858585; font-size: 13px;">
                                No video recording available for this test run.
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="close-results-btn" class="btn btn-primary">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Viewer Modal -->
        <div id="video-viewer-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="video-viewer-title">üìπ Test Recording</h2>
                    <span class="close-video-viewer">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="video-viewer-container">
                        <video id="video-viewer-player" controls style="width: 100%; max-height: 500px; border-radius: 8px; background: #000;">
                            <source id="video-viewer-source" type="video/webm">
                            Your browser does not support video playback.
                        </video>
                        <div class="video-viewer-info">
                            <p id="video-viewer-timestamp" style="color: #858585; font-size: 13px; margin-top: 12px;"></p>
                            <p id="video-viewer-size" style="color: #858585; font-size: 13px;"></p>
                        </div>
                        <div class="video-actions" style="margin-top: 16px;">
                            <button id="video-viewer-download-btn" class="btn btn-secondary">
                                üì• Download Video
                            </button>
                        </div>
                    </div>
                    <div id="video-viewer-no-recording" style="display: none; text-align: center; padding: 40px; color: #858585;">
                        <p style="font-size: 48px; margin-bottom: 16px;">üé•</p>
                        <p>No recordings available for this test.</p>
                        <p style="font-size: 13px; margin-top: 8px;">Run the test to create a recording.</p>
                    </div>
                </div>
            </div>
        </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
